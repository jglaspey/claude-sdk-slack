# Agent File Structure: Key Learnings from /agent Command

**Date:** October 29, 2025  
**Context:** Comparing manually created agent files vs Claude Code's `/agent` command output  
**Source:** Practical experimentation with Claude Code agent system

---

## Overview

When creating agent files for Claude Code, the structure and metadata fields matter significantly for discoverability and proper functioning. This document captures critical differences between manually created agents and those generated by Claude Code's `/agent` command.

## Critical Fields Comparison

### 1. `name` Field ‚úÖ **MOST CRITICAL**

**Status:** Required for agent discovery

```yaml
# /agent created (CORRECT)
name: contract-change-extractor  ‚úÖ HAS THIS

# Manual version (BROKEN)
# (no name field)  ‚ùå MISSING
```

**Why it matters:**
- The `name` field is likely how Claude Code indexes agents for discovery
- Enables matching agent invocations to files
- Required for agents to appear in `/agents` command
- Without it, agents may not be discoverable by the orchestrator

**Action:** Always include `name` field matching the filename (without .md extension)

---

### 2. `description` Field - Elaborate vs Simple

**Manual version (too simple):**
```yaml
description: Extracts and classifies tracked changes from NDA Word documents. 
  Use at the start of every NDA review to prepare the change list.
```

**`/agent` version (comprehensive with examples):**
```yaml
description: Use this agent when you need to extract and classify tracked changes 
  from an NDA Word document at the beginning of a review process. This agent should 
  be invoked:\n\n<example>...[3 full examples with context, user input, assistant 
  response, and commentary]...</example>
```

**What `/agent` includes:**
- **When to use it** - Clear triggering conditions
- **Multiple `<example>` blocks** showing:
  - Context (workflow state)
  - User input (what triggers the agent)
  - Assistant response (how to invoke)
  - Commentary (why this agent is appropriate)
- **Workflow context** - Where in the process this fits
- **Expected output** - What the agent returns

**Benefits of detailed descriptions:**
- Better agent selection by orchestrator
- Clearer handoff patterns
- Reduces ambiguity about when to use the agent
- Provides examples for consistent invocation

---

### 3. `color` Field üé® **NEW**

```yaml
color: blue  # /agent version includes this
```

**Purpose:**
- UI display in Claude Code
- Visual differentiation between agents
- Likely used in agent list displays

**Options:** (inferred from common color schemes)
- `blue`, `green`, `red`, `yellow`, `purple`, `orange`, etc.

**Action:** Add for better UX, though probably not required for functionality

---

### 4. `tools` Field - Explicit vs Inherited

```yaml
# Manual version (explicit)
tools: Read, Bash  ‚úÖ Explicit permissions

# /agent version (omitted)
# (no tools field)  ‚Üí Inherits all available tools
```

**Trade-offs:**
- **Explicit tools:** Better security, clearer permissions, principle of least privilege
- **Omitted tools:** More flexible, agent can use any tool as needed

**Recommendation:** 
- Use explicit `tools` for security-sensitive agents
- Omit for general-purpose agents that need flexibility

---

### 5. `model` Field - Strategic Choice

```yaml
# Manual version
model: haiku  # Fast, cheap for simple extraction

# /agent version  
model: sonnet  # More capable, better reasoning
```

**Considerations:**
- **Haiku:** Fast, cost-effective for straightforward tasks (extraction, formatting)
- **Sonnet:** Better reasoning for complex analysis, decision-making
- **Opus:** Highest capability for critical decisions (rarely needed for subagents)

**Strategy:** Match model to task complexity and cost sensitivity

---

## Body Content Structure

Both manual and `/agent` versions share similar body structure, but `/agent` is more detailed:

### Common Elements:
1. **Clear mission statement** - Single responsibility principle
2. **Step-by-step execution protocol** - Numbered steps
3. **What to do / what not to do** - Clear boundaries
4. **Error handling** - How to handle failures
5. **Success criteria** - What constitutes completion

### `/agent` Enhancements:
- More structured sections with clear headers
- Explicit workflow integration points
- Detailed error scenarios
- More comprehensive success criteria

---

## The Critical Insight

**The `name` field is THE key difference for agent discoverability.**

Without it, Claude Code cannot:
- Index the agent for discovery
- Match invocations to agent files
- Display the agent in `/agents` command
- Enable proper orchestrator handoffs

---

## Recommended Agent File Template

```yaml
---
name: agent-name-matching-filename
description: |
  Clear statement of when to use this agent.
  
  <example>
  Context: [Workflow state or situation]
  
  user: "[User input that triggers this agent]"
  
  assistant: "[How to invoke this agent]"
  
  <commentary>
  [Why this agent is appropriate for this situation]
  </commentary>
  </example>
  
  [Additional examples as needed]
model: haiku|sonnet|opus
tools: Read, Bash, Write  # Optional: omit for full tool access
color: blue  # Optional: for UI display
---

# Agent Name

## Your Core Mission

[Single clear responsibility statement]

## Execution Protocol

1. [Step 1]
2. [Step 2]
3. [Step 3]

## What You Must Do

- [Required behavior 1]
- [Required behavior 2]

## What You Must NOT Do

- [Prohibited behavior 1]
- [Prohibited behavior 2]

## Error Handling

- [Error scenario 1]: [How to handle]
- [Error scenario 2]: [How to handle]

## Success Criteria

- [Criterion 1]
- [Criterion 2]
```

---

## Action Items for Existing Agents

### Immediate (Critical):
- [ ] Add `name` field to all agent files
- [ ] Verify `name` matches filename (without .md)
- [ ] Test agent discoverability with `/agents` command

### High Priority:
- [ ] Expand `description` fields with examples
- [ ] Add `<example>` blocks showing invocation patterns
- [ ] Include context and commentary in examples

### Nice to Have:
- [ ] Add `color` field for UI consistency
- [ ] Review `model` choices for cost/capability balance
- [ ] Consider explicit `tools` for security-sensitive agents

---

## Testing Agent Discoverability

After adding `name` fields:

```bash
# In Claude Code
/agents  # Should list all agents with names

# Test invocation
"Use the [agent-name] agent to [task description]"
```

If agents don't appear or aren't invoked properly, check:
1. `name` field exists and matches filename
2. File is in `.claude/agents/` directory
3. YAML frontmatter is properly formatted
4. No syntax errors in frontmatter

---

## References

- Claude Code Agent SDK documentation
- Practical experimentation with `/agent` command
- Comparison of manual vs generated agent files

---

## Key Takeaway

**Always include the `name` field in agent frontmatter.** It's the critical piece that enables Claude Code to discover, index, and properly invoke your agents. Without it, even well-structured agents may be invisible to the orchestrator.
